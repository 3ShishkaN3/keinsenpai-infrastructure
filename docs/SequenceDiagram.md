# Диаграмма последовательностей

![Диаграмма последовательностей](SequenceDiagram.svg)

## Описание
Диаграмма последовательностей иллюстрирует ключевые сценарии взаимодействия пользователя с платформой **Keisenpai**. Здесь описаны процессы авторизации, загрузки курсов, выполнения тестов и взаимодействия с системой уведомлений и достижений. Для редактирования диаграммы см. [Код диаграммы последовательностей](docs/SequenceDiagram.txt). Диаграмма создавалась на платформе [PlantUML](https://www.plantuml.com/).

### Основные сценарии

#### 1. **Авторизация и загрузка профиля**
Пользователь заходит на платформу через веб-клиент, отправляет данные для авторизации, и после успешной аутентификации ему предоставляется доступ к профилю:
1. Пользователь вводит данные для входа.
2. Веб-клиент отправляет запрос на API Шлюз для авторизации.
3. API Шлюз проверяет учетные данные пользователя через Сервис авторизации.
4. Сервис авторизации обращается к Сервису пользователей для получения данных.
5. Данные пользователя проверяются в базе данных.
6. Если авторизация успешна, создается сессия, которая кэшируется в Redis.
7. Пользователю возвращается JWT токен.
8. Пользователь получает свой профиль, включая статистику и прогресс.

#### 2. **Загрузка курса**
Пользователь выбирает курс, который он хочет изучить, и загружает структуру и содержание курса:
1. Пользователь выбирает курс, отправляя запрос через веб-клиент.
2. Веб-клиент запрашивает данные о курсе через API Шлюз.
3. API Шлюз обращается к Сервису курсов, который проверяет кэш.
4. Если данные не в кэше, они извлекаются из базы данных и кэшируются.
5. Прогресс пользователя загружается через Сервис прогресса.
6. Веб-клиент получает полную информацию о курсе для отображения.

#### 3. **Изучение урока**
После выбора курса пользователь загружает конкретный урок:
1. Пользователь выбирает урок.
2. Веб-клиент отправляет запрос на загрузку урока через API Шлюз.
3. Сервис уроков проверяет кэш, если данные отсутствуют, они загружаются из базы данных.
4. Сервис материалов предоставляет URL медиафайлов через CDN.
5. Веб-клиент отображает урок.

#### 4. **Прохождение тестов**
Пользователь приступает к тестированию после изучения материалов:
1. Пользователь начинает тестирование через веб-клиент.
2. API Шлюз отправляет запрос на Сервис тестирования.
3. Сервис тестирования инициализирует разные типы тестов (аудирование, соответствие, чтение и т.д.).
4. Медиа-контент загружается через Сервис материалов и CDN.
5. После завершения теста результаты отправляются на сервер для проверки.
6. Прогресс обновляется, результаты сохраняются в базе данных, и создаются события в Очереди сообщений.
7. Очередь сообщений взаимодействует с Сервисом достижений для проверки выполнения условий наград.
8. Если пользователь достиг нового уровня, создается уведомление через Сервис уведомлений.

#### 5. **Работа с календарем и статистикой**
Пользователь может управлять своим календарем и отслеживать прогресс:
1. Пользователь загружает календарь для создания и редактирования заметок.
2. Система отображает статистику и аналитические данные, кэшируя их для ускорения загрузки.

## Примечания
- Использование кэширования (Redis) помогает уменьшить нагрузку на базу данных.
- Очередь сообщений (RabbitMQ или аналог) обрабатывает асинхронные задачи, такие как выдача достижений или отправка уведомлений.
- Медиафайлы хранятся в CDN, чтобы уменьшить задержки и повысить производительность.
